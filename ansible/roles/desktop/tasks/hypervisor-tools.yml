---

- name: Ensure dmidecode is installed
  apt:
    name: dmidecode

- name: Detect Hypervisor
  command: dmidecode -s system-product-name
  changed_when: false
  ignore_errors: true
  register: hypervisor

- name: Start parallels dynamic resolution tool at startup
  lineinfile:
    dest: /etc/X11/Xsession
    line: /usr/lib/parallels-tools/tools/prltools.x64/xorg.7.1/usr/bin/prlcc &
    insertafter: '#!/bin/sh'
  when: hypervisor.stdout == 'Parallels Virtual Platform'

- name: Start parallels copy paste tool at startup
  lineinfile:
    dest: /etc/X11/Xsession
    line: /usr/lib/parallels-tools/tools/prltools.x64/xorg.7.1/usr/bin/prlcp &
    insertafter: '#!/bin/sh'
  when: hypervisor.stdout == 'Parallels Virtual Platform'

- name: Install Vmware desktop tools
  apt:
    name: open-vm-tools-desktop
  when: hypervisor.stdout == 'VMware Virtual Platform'

- name: Start vmware dynamic resolution tool at startup
  lineinfile:
    dest: /etc/X11/Xsession
    line: /usr/bin/vmware-user-suid-wrapper
    insertafter: '#!/bin/sh'
  when: hypervisor.stdout == 'VMware Virtual Platform'
