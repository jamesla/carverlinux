---

  - name: Detect Hypervisor
    shell: dmidecode -s system-product-name
    register: hypervisor
    ignore_errors: yes

  - name: Start parallels dynamic resolution tool at startup
    lineinfile:
      dest: /etc/X11/Xsession
      line: prlcc &
      insertafter: '#!/bin/sh'
    when: hypervisor.stdout == 'Parallels Virtual Platform'

  - name: Install Vmware desktop tools
    apt:
      name: open-vm-tools-desktop
    when: hypervisor.stdout == 'VMware Virtual Platform'

  - name: Start vmware dynamic resolution tool at startup
    lineinfile:
      dest: /etc/X11/Xsession
      line: /usr/bin/vmware-user-suid-wrapper
      insertafter: '#!/bin/sh'
    when: hypervisor.stdout == 'VMware Virtual Platform'
